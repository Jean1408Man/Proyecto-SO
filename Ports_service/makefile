###############################################################################
#  Makefile â€“ Proyecto â€œPorts_serviceâ€
#
#  Compila todos los .c que haya en src/ y deja el ejecutable en la raÃ­z
#  Usa glib-2.0 (hash table) y pthread (hilos).
#
#  Objetivos principales:
#     make          â†’ compila en modo optimizado (-O2)
#     make debug    â†’ compila con sÃ­mbolos de depuraciÃ³n (-g)
#     make clean    â†’ borra objetos y ejecutables
###############################################################################

# â”€â”€â”€â”€â”€â”€â”€â”€ ConfiguraciÃ³n â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CC       ?= gcc
CFLAGS   ?= -std=c11 -Wall -Wextra -O2
CPPFLAGS ?= -Iinclude `pkg-config --cflags glib-2.0`
LDFLAGS  ?= `pkg-config --libs glib-2.0` -lpthread
TARGET    = escaner

# â”€â”€â”€â”€â”€â”€â”€â”€ Archivos fuente y objetos â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SRC := $(wildcard src/*.c)
OBJ := $(patsubst src/%.c, build/%.o, $(SRC))

# Crea la carpeta build/ si no existe (silenciosamente)
$(shell mkdir -p build)

# â”€â”€â”€â”€â”€â”€â”€â”€ Reglas principales â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
all: $(TARGET)

build/%.o: src/%.c include/*.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $< -o $@

$(TARGET): $(OBJ)
	$(CC) $(OBJ) $(LDFLAGS) -o $@
	@echo "âœ“ Binario generado: ./$@"

# â”€â”€â”€â”€â”€â”€â”€â”€ Modos adicionales â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
debug: CFLAGS = -std=c11 -Wall -Wextra -g -O0
debug: clean all

clean:
	@echo "ğŸ§¹ Limpiando..."
	@rm -rf build/*.o $(TARGET)

.PHONY: all debug clean